<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <title>PvaClient</title>
  <link rel="stylesheet" type="text/css"
  href="../../css/base.css" />
  <link rel="stylesheet" type="text/css"
  href="../../css/epicsv4.css" />
  <style type="text/css">
  /*<![CDATA[*/
     .about { margin-left: 3em; margin-right: 3em; font-size: .83em}
     table { margin-left: auto; margin-right: auto }
     .diagram { text-align: center; margin: 2.5em 0 }
     span.opt { color: grey }
     span.nterm { font-style:italic }
     span.term { font-family:courier }
     span.user { font-family:courier }
     span.user:before { content:"<" }
     span.user:after { content:">" }
     .nonnorm { font-style:italic }
     p.ed { color: #AA0000 }
     span.ed { color: #AA0000 }
     p.ed.priv { display: inline; }
     span.ed.priv { display: inline; }
  /*]]>*/</style>
  <!-- Script that generates the Table of Contents -->
  <script type="text/javascript"
  src="../../css/tocgen.js">
  </script>
</head>

<body>

<div class="head">
<h1>pvDatabaseCPP</h1>
<h2 class="nocount">March 2021</h2>
<dl>
  <dt>Editors:</dt>
    <dd>Marty Kraimer</dd>
</dl>
<h2 class="nocount">WORK IN PROGRESS: NOT READY FOR USERS</h2>
<p>This product is available via an <a
href="../../LICENSE">open source license
</a></p>

</div>

<div id="toc">
<h2 class="nocount" style="page-break-before: always">Table of Contents</h2>
</div>

<div id="contents" class="contents">

<h2>Overview</h2>
<p>
This document is the guide for pvDatabaseCPP, which is one of the components of
<a href="https://epics-controls.org/resources-and-support/base/epics-7/">
EPICS-7
</a>.
<br/>
It is intended for developers that want to use pvDatabaseCPP.
</p>
<p>
A guide for developers is available at
<a
href="https://mrkraimer.github.io/website/developerGuide/developerGuide.html">
developerGuide
</a>
<br/>
This guide discusses the modules that are part of an EPICS7 release.
Some understanding of the components and how they are related is necessary in order to
develop code that uses pvDatabaseCPP.
In particular read everything related to pvDatabase.
</p>

<p>Doxgen for pvDatabase is located at:
<a
href="./html/index.html">doxygen
</a>.
</p>

<p><b>pvDatabase</b> is a framework for implementing a network accessible database of smart memory resident
records. Network access is via pvAccess. The data in each record is a top level PVStructure as defined by
pvData. The framework includes a complete implementation of ChannelProvider as defined by pvAccess.
The framework can be extended in order to create record instances that implements services.
The minimum that an extension must provide is a top level PVStructure and a process method.
</p>


<p>pvDatabase has plugin support, which is implemented in <b>pvCopy</b>.
</p>
<p>
See
<a
href="https://mrkraimer.github.io/website/pvRequest/pvRequest.html">
pvRequest
</a>
for details.
</p>


<h2>pvDatabase.h</h2>
<h3>PVDatabase Brief Description</h3>
<p><b>PVDatabase</b> has methods:</p>
<pre>
findRecord       Find a record in the database.
addRecord        Add a record to the database.
removeRecord     Remove a record from the database.
getRecordNames   Get the names of all the records in the database.
getMaster        Get the master database. This is what clients access.
</pre>
<h3>PVRecord Brief Description</h3>
<pre>
The following are optional methods.
init                 Initialization method.
start                Called before a record is added to database.
process              Process the record.
remove               Remove the PVRecord.
getService           Return a service corresponding to the specified request PVStructure.
The following are supplied by the base class.
create               Create a soft record.
getRecordName        Get the record name.
getPVStructure       Get the PVStructure for the record.
getPVRecordStructure Get the PVRecordStrucure.
findPVRecordField    Find a PVRecordField
lock                 Lock the record. No other code can access the record until unlock
unlock               Unlock the record.
tryLock              Try to lock the record.
lockOtherRecord      Client holding lock can lock one other record.
addPVRecordClient    Every client that accesses the record must call this
                     so that theclient can be notified when the record is deleted.
addListener          This must be called before calling pvRecordField.addListener.
nextMasterPVField    PVCopyTraverseMasterCallback method.
removeListener       Remove a listener.
beginGroupPut        Begins a group of puts.
endGroupPut          Ends a group of puts.
getTraceLevel        Get trace level (0,1,2) means (nothing,lifetime,process)
setTraceLevel        Set trace level (0,1,2) means (nothing,lifetime,process)
getAsLevel           Get the AS level.
getAsGroup           Get the AS group name.
setAsLevel           Set access security level.
setAsGroup           Set access security group.
</pre>
<h3>PVRecordStructure</h3>
<p><b>PVRecordStructure</b> has methods:</p>
<pre>
getPVRecordFields
getPVStructure
</pre>
<h3>PVRecordField</h3>
<p><b>PVRecordField</b> has methods:</p>
<pre>
getParent
getPVField
getFullFieldName
getFullName
getPVRecord
postPut
</pre>
<h3>PVRecordClient</h3>
<p><b>PVRecordClient</b> has methods:</p>
<pre>
detach
</pre>
<h3>PVListener</h3>
<p><b>PVListener</b> has methods:</p>
<pre>
dataPut
beginGroupPut
endGroupPut
unlisten
</pre>
<h2>channelProviderLocal</h2>
<h3>ChannelProviderLocal</h3>
<p><b>ChannelProviderLocal</b> has methods:</p>
<pre>
initAs
isAsActive
getProviderName
channelFind
channelList
createChannel
getTraceLevel
setTraceLevel
getChannelProvider
</pre>
<h3>ChannelLocal</h3>
<p><b>ChannelLocal</b> has methods:</p>
<pre>
detach
getRequesterName
message
getProvider
getRemoteAddress
getConnectionState
getChannelRequester
isConnected
getField
getAccessRights
createChannelProcess
createChannelGet
createChannelPut
createChannelPutGet
createChannelRPC
createMonitor
createChannelArray
printInfo
canWrite
canRead
</pre>
<h2>pvSupport</h2>
<h3>PVSupport</h3>
<p><b>PVSupport</b> has methods:</p>
<pre>
init
start
process
reset
</pre>
<h3>ScalarAlarmSupport</h3>
<p><b>ScalarAlarmSupport</b> has methods:</p>
<pre>
init
process
reset
create
scalarAlarmField
</pre>
<h3>ControlSupport</h3>
<p><b>ControlSupport</b> has methods:</p>
<pre>
init
process
reset
create
controlField
</pre>
<h2>pvPlugin</h2>
<h3>PVPlugin</h3>
<p><b>PVPlugin</b> has methods:</p>
<pre>
create
</pre>
<h3>PVPluginRegistry</h3>
<p><b>PVPluginRegistry</b> has methods:</p>
<pre>
registerPlugin
find
</pre>
<h3>PVFilter</h3>
<p><b>PVFilter</b> has methods:</p>
<pre>
filter
getName
</pre>
<h3>PVArrayPlugin</h3>
<p><b>PVArrayPlugin</b> has methods:</p>
<pre>
create
</pre>
<h3>PVArrayFilter</h3>
<p><b>PVArrayFilter</b> has methods:</p>
<pre>
create
filter
getName
</pre>
<h3>PVDeadbandPlugin</h3>
<p><b>PVDeadbandPlugin</b> has methods:</p>
<pre>
create
</pre>
<h3>PVDeadbandFilter</h3>
<p><b>PVDeadbandFilter</b> has methods:</p>
<pre>
create
filter
getName
</pre>
<h3>PVTimestampPlugin</h3>
<p><b>PVTimestampPlugin</b> has methods:</p>
<pre>
create
</pre>
<h3>PVTimestampFilter</h3>
<p><b>PVTimestampFilter</b> has methods:</p>
<pre>
create
filter
getName
</pre>

<h2>exampleCPP</h2>
<p>Example code is available at:
<a
href="https://github.com/epics-base/exampleCPP">
exampleCPP
</a>
</p>
<p>In particular look at the example code mentioned in the following sub-sections.
</p>

<h3>database</h3>
<p>This has many examples of how to create both soft records and records that implement
other functionality.</p>
<dl>
   <dt>exampleDatabase.cpp</dt>
     <dd>
      This shows how to create soft records of each pvData type.<br />
      In addition shows how to create instances of the following two records.
     </dd>
   <dt>exampleHelloRecord.cpp</dt>
     <dd>
       This is a simple "hello world" that is intentended to be used via a channelPutGet request.
     </dd>
   <dt>exampleHelloRPC.cpp</dt>
     <dd>
       This is a simple "hello world" that is intentended to be used via a channelRPC request.
     </dd>
   <dt>exampleDatabaseMain.cpp</dt>
     <dd>
      This shows how to create a standalone IOC.
     </dd>
   <dt>ioc and iocBoot</dt>
     <dd>
      This has code and examples to create a V3 IOC which also has a PVDatabase.
     </dd>
</dl>
<h3>exampleLink</h3>
<p>This shows how to implement a record that has a link to another record</p>
<dl>
  <dt>exampleMonitorLinkRecord</dt>
     <dd>
      This creates a monitor link to another record.
     </dd>
  <dt>exampleGetLinkRecord</dt>
     <dd>
      This creates a get link to another record.
     </dd>
  <dt>examplePutLinkRecord</dt>
     <dd>
      This creates a put link to another record.
     </dd>
</dl>

<h3>support</h3>
<p>This creates records that have the following features:</p>
<dl>
   <dt>value</dt>
   <dd>
    Each record has a value field the is a numeric scalar field.
    In addition each has the following fields:
    alarm,timeStamp,control,scalarAlarm, and display.
   </dd>
   <dt>support</dt>
   <dd>
     Each record uses the control and scalarAlarm support provided by pvDatabaseCPP.
   </dd>
</dl>
<p>
It also creates records that can be used by clients to show example of the plugin support.
</p>

<h2>iocshell commands</h2>
<p>Shell commands are made available via the standard DBD include mechanism
provided by iocCore.
The following provide EPICS V4 shell commands:</p>
<pre>
pvAccessCPP
qsrv
pvDatabaseCPP
</pre>

<p>pvDatabaseCPP provides the following iocshell command.</p>
<dl>
   <dt>registerChannelProviderLocal</dt>
     <dd>Including <b>registerChannelProviderLocal.dbd</b> as a dbd file automatically starts provider local
      and also creates the pvdbl shell command.
     </dd>
   <dt>pvdbl</dt>
      <dd>Provides a list of all the pvRecords in database <b>master</b>
      </dd>
</dl>
<p>In addition any code that implements a PVRecord must implement an ioc command.
Look at the examples in <b>exampleCPP/support</b> to see how to implement shell commands.</p>

</div>
</body>
</html>
