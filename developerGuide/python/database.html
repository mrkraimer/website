<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <title>database</title>
  <link rel="stylesheet" type="text/css"
  href="../../css/base.css" />
  <link rel="stylesheet" type="text/css"
  href="../../css/epicsv4.css" />
  <style type="text/css">
  /*<![CDATA[*/
     .about { margin-left: 3em; margin-right: 3em; font-size: .83em}
     table { margin-left: auto; margin-right: auto }
     .diagram { text-align: center; margin: 2.5em 0 }
     span.opt { color: grey }
     span.nterm { font-style:italic }
     span.term { font-family:courier }
     span.user { font-family:courier }
     span.user:before { content:"<" }
     span.user:after { content:">" }
     .nonnorm { font-style:italic }
     p.ed { color: #AA0000 }
     span.ed { color: #AA0000 }
     p.ed.priv { display: inline; }
     span.ed.priv { display: inline; }
  /*]]>*/</style>
  <!-- Script that generates the Table of Contents -->
  <script type="text/javascript"
  src="../../css/tocgen.js">
  </script>
</head>
<body>

<div class="head">
<h1>testPython/database</h1>

<h2 class="nocount">2020.06.20</h2>
<dl>
  <dt>Author:</dt>
    <dd>Marty Kraimer</dd>
  <dt>WARNING</dt>
     <dd>
      This is a work in progress.
     </dd>
</dl>

<p>This product is available via an <a
href="../../LICENSE">open source license
</a></p>

</div>


<div id="toc">

<h2 class="nocount" style="page-break-before: always">Table of Contents</h2>
</div>
<div id="contents" class="contents">


<h2>Introduction</h2>
<p>This document describes the IOC database used by the Python examples.
</p>
<p>See
<a href="index.html">index</a>
For installation instructions.
</p>
<p>
<b>testPython/database</b>
creates an IOC database that can have DBRecords for any of the record types
provided  by EPICS base.
In addition it has PVRecords used by the Python code in
examples qtimage, maldebrot and plot2dcurves.
</p>
<p>
When the database is started as follows:
</p>
<pre>
mrk> pwd
/home/epics7/testPython/database/iocBoot/testPython
mrk> ../../bin/linux-x86_64/testPython st.cmd 
</pre>
<p>
It has the following records:
</p>
<pre>
epics> dbl
TPYcounter01
epics> pvdbl
TPYaddRecord
TPYmandelbrotRecord
TPYqt2dimageRecord
TPYqtpeakimageRecord
TPYremoveRecord
TPYtraceRecord
epics> 
</pre>
<h2>Description of Build environmant</h2>
<p>
When make is executed in <b>testPython/database</b>,
An IOC database is created that contains the records shown above.
In addition this can be used as a model for creating other IOC databases that has a combination of DBRecords and PVRecords.
It can create DBRecords of any type implemented by <b>epics-base</b>
The following briefly describes the various subdirectorys of database.
</p>
<h3>database</h3>
<dl>
   <dt>RELEASE.local</dt>
      <dd>
      This is the only file in this directory that needs modification.
      <br />
      The only thing that is normaally changed is
       <b>EPICS7_DIR=/home/epics7/base-7.0.3.1</b>
       It must be changed to access your EPICS7 system. 
      </dd>
   <dt>CONFIG_SITE.local</dt>
      <dd>
      This should not need any changes.
      </dd>
   <dt>Makefile</dt>
      <dd>
       This should not need any changes.
      </dd>
   <dt>configure/*</dt>
      <dd>
       None of these files need any changes.
      </dd>
</dl>
<h3>database/src and database/src/pv</h3>
<p>
This is where code for special PVRecords are created.
For each four files are required.
For example <b>mandelbrotRecord</b>
has the following files:
</p>
<pre>
Makefile
pv/mandelbrotRecord.h
mandelbrotRecord.cpp
mandelbrotRecordRegister.cpp
mandelbrotRecordRegister.dbd
</pre>
<dl>
   <dt>Makefile</dt>
      <dd>
       Look at it to see what it does.
      </dd>
   <dt>pv/mandelbrotRecord.h</dt>
      <dd>
       This and the following C++ file implement code
        that creates a maldebrot image.
      It can be used as a model of how to create your own PVRecords.
      </dd>
   <dt>mandelbrotRecord.cpp</dt>
      <dd>
       This is the implementation.
      </dd>
   <dt>mandelbrotRecordRegister.cpp</dt>
      <dd>
      This implements the code that is called via the iocshell
      to create mandelbrot records.
      </dd>
   <dt>mandelbrotRecordRegister.dbd</dt>
      <dd>
      This is the definition that makes the iocshell aware of mandelbrotRecordRegister.
      </dd>
</dl>
<h3>dbSrc</h3>
<p>
This is where DBRecords are configured.
</p>
<h3>database/iocSrc</h3>
<p>This is where the actual IOC code is built.
Look at Makefile and testPythonInclude.dbd.
</p>
<h3>database/iocBoot</h3>
<p>Just look at the files.
Anyone who has built IOCs should be familar with the details.
</p>
<h2>Brief description of each PVRecord</h2>
<h3>TPYmandelbrotRecord</h3>
<p>This has fields:
</p>
<pre>
    structure
        time_t timeStamp
            long secondsPastEpoch
            int nanoseconds
            int userTag
        structure argument
            double xmin
            double xmax
            double ymin
            double ymax
            int width
            int height
            int nz
        structure result
            ubyte[] value
</pre>
<p>
This is used by <b>testPython/mandelbrot/DisplayImagePVAPY.py</b>
<br />
It computes mandelbrot images.
<br />
See :
<a href="https://en.wikipedia.org/wiki/Mandelbrot_set">mandelbrot</a>
for a description.
</p>

<h3>TPYqt2dimageRecord</h3>
<p>This has fields:
</p>
<pre>
    structure
        time_t timeStamp
            long secondsPastEpoch
            int nanoseconds
            int userTag
        string name
        double[] x
        double[] y
        double xmin
        double xmax
        double ymin
        double ymax
        structure argument
            structure format
                int index
                string[] choices
            int height
            int width
        structure result
            union value
                ubyte[] uint8
                ushort[] uint16
                uint[] uint32
</pre>
<p>This is used by <b>testPython/plot2dcurve</b> and can also
be used by <b>testPython/qtimage</b>.
</p>
<p>See
<a href="plot2dcurve.html">plot2dcurve</a>
and
<a href="qtimage.html">qtimage</a>
For details.
</p>
<h3>TPYqtpeakimageRecord</h3>
<p>This has fields:
</p>
<pre>
    structure
        time_t timeStamp
            long secondsPastEpoch
            int nanoseconds
            int userTag
        structure peak
            double x
            double xwidth
            double y
            double ywidth
            double intensity
        structure argument
            structure format
                int index
                string[] choices
            int height
            int width
        structure result
            union value
                ubyte[] uint8
                ushort[] uint16
                uint[] uint32

</pre>
<p>This is used by <b>testPython/qtimage</b>.
</p>
<p>See
<a href="qtimage.html">qtimage</a>
For details.
</p>
<h3>TPYaddRecord,TPYremoveRecord, and TPYtraceRecord</h3>
<p>These are implemented by <b>pvDatabaseCPP</b>.
<br />
<b>testPython/plot2dcurve</b> uses TPYaddRecord.
The others are not used in this application
but may be of interest to other applications.
</p>
</div>
</body>
</html>
